@model CDMIS.ViewModels.BasicProfileViewModel
@{
    ViewBag.Title = "患者建档--个人信息";
    Layout = "~/Views/Shared/_DoctorLayout.cshtml";
}
<link href="../../Content/flexibleDisplay.css" rel="stylesheet" type="text/css" />
<link href="../../Content/simpleModal.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="../../Scripts/My97DatePicker/WdatePicker.js"></script>
<script src="../../Scripts/jquery.simplemodal.1.4.4.min.js" type="text/javascript"></script>

<style type="text/css">         
    #simplemodal-container
    {
        height: 250px;
        width: 400px;
    }
    #delete-container
    {
        height: 160px;
        width: 400px;
    }
    #findPatient-container
    {
        height: 600px;
        width: 900px;
    }
    .odd
    {
        background-color: #E0E0E0;
    }
    .even
    {
        background-color: #FFFFFF;
    }
    /* Adjusting the margins, paddings and no list styles */
    
    #nav
    {
        overflow: hidden;
        width: 100%;
        margin: 0;
        padding: 0;
        list-style: none;
    }
    
    #nav li
    {
        float: left;
        margin: 0 -15px 0 0;
        font-family: \9ED1\4F53;
        font-size: 15px;
    }
    
    #nav li a
    {
        float: left;
        position: relative;
        padding: 0 40px;
        height: 0;
        line-height: 30px;
        text-transform: uppercase;
        text-decoration: none;
        color: #fff;
        border-right: 30px solid transparent;
        border-bottom: 30px solid #3D3D3D;
        border-bottom-color: #6C6C6C;
        opacity: .8;
        filter: alpha(opacity=30);
    }
    
    #nav a:hover, #tabs a:focus
    {
        border-bottom-color: #2ac7e1;
        opacity: 1;
        filter: alpha(opacity=100);
    }
    
    #nav a:focus
    {
        outline: 0;
    }
    
    #nav #currentnav
    {
        border-bottom-color: #00A600;
        opacity: 1;
        filter: alpha(opacity=100);
    }
</style>
<input type="text" id="UId" style="display:none" value="@Model.Patient.UserId"/>
<input type="text" id="OperationInvalidFlag" style="display:none" value="@ViewBag.OperationInvalidFlag"/>
<input type="text" id="EditDeleteFlag" style="display:none" value="@ViewBag.EditDeleteFlag"/>
<div style="height: 40px;display:none" id="navDiv">
    <ul id="nav">
        <li>
            @Html.ActionLink("个人信息", "BasicProfile", "DoctorHome", new { PatientId = @Model.Patient.UserId }, new { target = "_self" })</li>
        <li>
            @Html.ActionLink("健康模块", "ModuleProfile", "DoctorHome", new { PatientId = @Model.Patient.UserId }, new { target = "_self" })</li>
        <li>
            @Html.ActionLink("就诊信息", "ClinicalInfo", "DoctorHome", new { UserId = @Model.Patient.UserId }, new { target = "_self" })</li>
        <li>
            @Html.ActionLink("临床信息", "ClinicalProfile", "DoctorHome", new { UserId = @Model.Patient.UserId }, new { target = "_self" })</li>
    </ul>
</div>

@using (Html.BeginForm("BasicProfile", "DoctorHome", FormMethod.Post, new { id = "Form1", enctype = "multipart/form-data" }))
{
    //个人信息
    <div class="personalInfoDiv">
        <p class="dropdown" id="personalInfoToggle">
            个人信息<i class="icon-arrow open-arrow"></i></p>
        <div id="personalInfo" class="dropdown-div">
            <div class="form-horizontal" role="form">
                <div class="form-group">
                    <label class="col-sm-2 control-label">
                        患者Id</label>
                    <div class="col-sm-4">
                        @Html.TextBoxFor(model => model.Patient.UserId, new { id = "UserId", @class = "form-control", @readonly = "readonly" })
                        @Html.ValidationMessageFor(model => model.Patient.UserId)
                    </div>
                    <div class="col-sm-2">
                    </div>
                    <div class="col-sm-2">
                        <input type="button" value="新建" class="btn btn-primary addNewPat" disabled="disabled" />
                    </div>
                    <div class="col-sm-2">
                        <input type="button" value="查找" class="btn btn-primary findPat" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">
                        *患者姓名</label>
                    <div class="col-sm-4">
                        @Html.TextBoxFor(model => model.Patient.UserName, new { id = "UserName", @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.Patient.UserName)
                    </div>
                    <label class="col-sm-2 control-label">
                        *性别</label>
                    <div class="col-sm-4">
                        @Html.DropDownListFor(model => model.Patient.Gender, Model.GenderList(), new { id = "GenderListDropDownList", @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.Patient.Gender)
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">
                        *出生日期</label>
                    <div class="col-sm-4">
                        @Html.TextBoxFor(model => model.Patient.Birthday, new { id = "Birthday", @onclick = "WdatePicker({maxDate:'%y-%M-%d'})", @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.Patient.Birthday)
                    </div>
                    <label class="col-sm-2 control-label">
                        血型</label>
                    <div class="col-sm-4">
                        @Html.DropDownListFor(model => model.Patient.BloodType, Model.BloodTypeList(), new { id = "BloodTypeDropDownList", @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.Patient.BloodType)
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">
                        医保类型</label>
                    <div class="col-sm-4">
                        @Html.DropDownListFor(model => model.Patient.InsuranceType, Model.InsuranceTypeList(), new { id = "InsuranceTypeDropDownListFor", @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.Patient.InsuranceType)
                    </div>
                    <label class="col-sm-2 control-label">
                        身份证号码</label>
                    <div class="col-sm-4">
                        @Html.TextBoxFor(model => model.Patient.IDNo, new { id = "IDNo", style = "font-size:15px", @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.Patient.IDNo)
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">
                        联系电话</label>
                    <div class="col-sm-4">
                        @Html.TextBoxFor(model => model.Phone, new { id = "Phone", style = "font-size:15px", @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.Phone)
                    </div>
                    <label class="col-sm-2 control-label">
                        家庭住址</label>
                    <div class="col-sm-4">
                        @Html.TextBoxFor(model => model.Address, new { id = "Address", style = "font-size:15px", @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.Address)
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">
                        职业</label>
                    <div class="col-sm-4">
                        @Html.TextBoxFor(model => model.Occupation, new { id = "Occupation", style = "font-size:15px", @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.Occupation)
                    </div>
                    <label class="col-sm-2 control-label">
                        国籍</label>
                    <div class="col-sm-4">
                        @Html.TextBoxFor(model => model.Nationality, new { id = "Nationality", style = "font-size:15px", @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.Nationality)
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">
                        紧急联系人</label>
                    <div class="col-sm-4">
                        @Html.TextBoxFor(model => model.EmergencyContact, new { id = "EmergencyContact", style = "font-size:15px", @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.EmergencyContact)
                    </div>
                    <label class="col-sm-2 control-label">
                        紧急联系人电话</label>
                    <div class="col-sm-4">
                        @Html.TextBoxFor(model => model.EmergencyContactNumber, new { id = "EmergencyContactNumber", style = "font-size:15px", @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.EmergencyContactNumber)
                    </div>
                </div>
            </div>
            <input type="submit" value="下一步" class="btn btn-primary submitBtn" style="float: right" />
        </div>
    </div>                              
}
@*查找患者*@
<div id="findPatient" style="display: none; text-align: center">
    <div class="modalHeader">
        <span style="margin-top: 20px">患者列表</span>
    </div>
    <div class="modalContent">
        <table style="margin-top: 20px; line-height: 40px;">
            <thead>
                <tr>
                    <th style="text-align: center">
                        患者Id
                    </th>
                    <th style="text-align: center">
                        患者姓名
                    </th>
                    <th style="text-align: center">
                        性别
                    </th>
                    <th style="text-align: center">
                        年龄
                    </th>
                    <th style="text-align: center">
                        已购模块
                    </th>
                    <th style="text-align: center">
                        操作
                    </th>
                </tr>
            </thead>
            <tbody id="TableBody">
                @if (Model.PatientList.Count > 0)
                {
                    foreach (var item in Model.PatientList)
                    {            
                    <tr>
                        <td width="5%" style="border: 0;">
                            @item.UserId
                        </td>
                        <td width="5%" style="border: 0;">
                            @item.UserName
                        </td>
                        <td width="5%" style="border: 0;">
                            @item.Gender
                        </td>
                        <td width="5%" style="border: 0;">
                            @item.Age
                        </td>
                        <td width="50%" style="border: 0;">
                            @item.Module
                        </td>
                        <td width="5%" style="border: 0;">
                            <input type="button" value="选择" class="btn btn-primary selectPatBtn" style="width: 50px;
                                height: 30px" />
                        </td>
                    </tr>
                    }
                }
                else
                {
                    <tr id="NotExist">
                        <td style="font-size: 15px;" colspan="9">
                            暂无数据！
                        </td>
                    </tr>
            
                }
            </tbody>
        </table>
    </div>
    <input type="button" class="btn btn-primary simplemodal-close" id="cancel" value="取消" />
</div>
<script type="text/javascript">
    $(document).ready(function () {
        $("#menu a").attr("id", ""); //Reset id's 
        $("#menu li:eq(1) a").attr("id", "current");

        if ($("#OperationInvalidFlag").val() == "true") {
            $(".addNewPat").removeAttr('disabled');
        }

        $("#TableBody tr:odd").addClass("odd");
        $("#TableBody tr:even").addClass("even");

        var UId = "@Model.Patient.UserId";
        if (UId != "") {
            $("#navDiv").show();
            $("#nav a").attr("id", ""); //Reset id's 
            $("#nav li:eq(0) a").attr("id", "currentnav");       
        }
    })

    $(".addNewPat").click(function () {
        $.ajax({
            url: "/DoctorHome/AddNewPat",
            type: "GET",
            dataType: "json",
            async: false,
            data: {},  //输入参数
            success: function (res) {
                if (res != "") {
                    $("#UserId").val(res);
                    $(".addNewPat").attr('disabled', 'disabled');
                }
                else {
                    alert("新建患者失败，请重试！");
                }
            }
        })
    })

    $(".findPat").click(function () {
        $('#findPatient').modal({
            //closeHTML: "<a href='#' title='Close' class='modal-close'>x</a>",
            containerId: 'findPatient-container',
            overlayClose: true     //点击蒙层关闭窗口
        });
    })

    $(document).on("click", ".selectPatBtn", function () {
        var trSeq = $(this).parent().parent().parent().find("tr").index($(this).parent().parent());
        var PId = $("#TableBody tr:eq(" + trSeq + ") td:eq(0)").text().trim();
        $("#cancel").click();
        window.location.href = "/DoctorHome/BasicProfile?PatientId=" + PId;
    })
</script>
